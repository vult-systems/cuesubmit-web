services:
  cuesubmit-web-dev:
    image: node:20-alpine
    container_name: cuesubmit-web-dev
    working_dir: /app
    command: sh -c "npm install && npm run dev"
    network_mode: host
    environment:
      - CUEWEB_MODE=online
      - CUEWEB_API_BASE=http://127.0.0.1:8448
      - REST_GATEWAY_URL=http://127.0.0.1:8448
      - JWT_SECRET=REDACTED_SECRET
      - SESSION_SECRET=REDACTED_SECRET
      - DATABASE_PATH=/app/data/cuesubmit.db
      - ADMIN_INITIAL_PASSWORD=${ADMIN_INITIAL_PASSWORD:-REDACTED_PASSWORD}
      - WATCHPACK_POLLING=true
    volumes:
      - .:/app
      - /app/node_modules
      - /app/.next
      - cuesubmit-data:/app/data
    # Required for native modules like bcrypt and better-sqlite3
    platform: linux/amd64

volumes:
  cuesubmit-data:
    external: true
